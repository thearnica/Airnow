import {  waterfall,  removeClassFrom,  inTime,  willRemoveClassFrom,  getBoundingClientRect, getScrollTop} from "./global";import {promoStart} from "./startPage";let advElementsOperationCount = 0;export const getPageScroll = (advElements) => {  let lastPageScroll = 0;  let lastScrollDelta = 0;  let lastVisibleScroll = 0;  const HEADER_SIZE = 110;  let resortScrollTimeout = 0;  const resortOnScroll = () => {    if (resortScrollTimeout) {      return;    }    let height = window.innerHeight;    let scrollTop = getScrollTop();    let bottom = height + scrollTop;    let items = advElements      .filter(({done}) => !done)      .map(function (item) {        return {          position: getBoundingClientRect(item),          item: item,        }      })      .sort(function (a, b) {        let diff = a.position.top - b.position.top;        if (Math.abs(diff) < 10) {          let oDiff = a.order - b.order;          return oDiff            ? oDiff            : a.position.left - b.position.left;        }        return diff;      })      .filter(itemRecord => itemRecord.position.top < bottom - height / 5)      .filter(itemRecord => itemRecord.position.bottom > 0);    if (items.length) {      const {item} = items[0];      item.done = true;      resortScrollTimeout = setTimeout(() => {          resortScrollTimeout = 0;          resortOnScroll();        }, item.dataset.noAnimationDelay ? 0 : 300      )    }  };  return function () {    let scrollTop = getScrollTop();    const header = document.querySelector('.airnow-header');    const deltaScroll = scrollTop - lastPageScroll;    if (scrollTop === 0) {      header.classList.remove('airnow-header-up');      header.classList.remove('airnow-header-down');      header.classList.remove('airnow-header--stage-2');    }    if (deltaScroll > 0) {      if (!header.classList.contains('airnow-header--down')) {        lastVisibleScroll = lastPageScroll;        header.style.top = lastPageScroll + 'px';        header.classList.remove('airnow-header--up');        header.classList.add('airnow-header--down');      }      if (scrollTop - lastVisibleScroll > HEADER_SIZE) {        header.classList.add('airnow-header--stage-2');      }    }    if (deltaScroll < 0) {      if (scrollTop - lastVisibleScroll > HEADER_SIZE) {        lastVisibleScroll = scrollTop - HEADER_SIZE;      }      if (scrollTop < lastVisibleScroll) {        header.style.top = 0 + 'px';        if (!header.classList.contains('airnow-header--up')) {          lastVisibleScroll = scrollTop;          header.classList.add('airnow-header--up');          header.classList.remove('airnow-header--down');        }      } else {        header.style.top = lastVisibleScroll + 'px';      }    }    lastScrollDelta = deltaScroll;    lastPageScroll = scrollTop;    if (scrollTop > 0) {    }    resortOnScroll();  }};const onPageScroll = () => {};let startAnimation = () => {  startAnimation = () => {  };  removeClassFrom('.airnow-page', 'airnow-page--hidden');  const pastScroll = getScrollTop() < 500 ? 1 : 0;  promoStart();  waterfall([    inTime(pastScroll * 100),    inTime(pastScroll * 0, willRemoveClassFrom('.airnow-promo', 'airnow-promo--hidden')),    inTime(pastScroll * 500),    inTime(pastScroll * 0, willRemoveClassFrom('.airnow-promo__title', 'airnow-promo__title--hidden')),    inTime(pastScroll * 50),    inTime(pastScroll * 0, willRemoveClassFrom('.airnow-header', 'airnow-header--hidden')),    inTime(pastScroll * 50),    inTime(pastScroll * 0, willRemoveClassFrom('.airnow-promo__text', 'airnow-promo__text--hidden')),    inTime(pastScroll * 50),    inTime(0, willRemoveClassFrom('.airnow-promo__get', 'airnow-promo__get--hidden')),    inTime(0, willRemoveClassFrom('.airnow-promo__or', 'airnow-promo__or--hidden')),    inTime(0, willRemoveClassFrom('.airnow-promo__start', 'airnow-promo__start--hidden')),    inTime(0, willRemoveClassFrom('.airnow-promo__item-wrapper', 'airnow-promo__item-wrapper--hidden')),    inTime(pastScroll * 300, onPageScroll),  ]);};startAnimation();